/* ================ General configuration ================ */
var Defaults = xdc.useModule('xdc.runtime.Defaults');
var Diags = xdc.useModule('xdc.runtime.Diags');
var Error = xdc.useModule('xdc.runtime.Error');
var Log = xdc.useModule('xdc.runtime.Log');
var Main = xdc.useModule('xdc.runtime.Main');
var Memory = xdc.useModule('xdc.runtime.Memory');
var System = xdc.useModule('xdc.runtime.System');
var Text = xdc.useModule('xdc.runtime.Text');

// Exclude log message format strings from final linked binary
// Tip: try 'false' with Logging Option B: LoggerBuf
Text.isLoaded = false;

var Timestamp = xdc.useModule('xdc.runtime.Timestamp');

/* ================ Logging configuration ================ */
Defaults.common$.diags_ASSERT = Diags.ALWAYS_ON;
Defaults.common$.diags_INTERNAL = Diags.ALWAYS_ON;
Defaults.common$.diags_INFO = Diags.ALWAYS_ON;

/* Turn on USER1 logs in Main module */
Main.common$.diags_USER1 = Diags.RUNTIME_ON;
Main.common$.diags_INFO = Diags.ALWAYS_ON;

// Gotta always keep it cause EventGen references it unconditionally (for
// debugging purposes)
var LoggerBuf = xdc.useModule('xdc.runtime.LoggerBuf');

// Option A: LoggerSys (sanity-test)
//var Logger = xdc.useModule('xdc.runtime.LoggerSys');
//var loggerInst = Logger.create();

// Option B: LoggerBuf (can also dump raw event to console)
// See EventGen.dumpEvent
var Logger = LoggerBuf
Logger.enableFlush = true;
var loggerInst = Logger.create({exitFlush: true});

// Option C: LoggerCallback (outputs raw binary event data)
// Tip: pipe the output through 'xxd' to see the bytes
//var Logger = xdc.useModule('xdc.runtime.LoggerCallback');
//Logger.outputFxn = '&eventgen_EventGen_logEvent'; 
//var loggerInst = Logger.create();

Defaults.common$.logger = loggerInst;

var EventGen = xdc.useModule('eventgen.EventGen');
EventGen.common$.diags_USER1 = Diags.ALWAYS_ON;
EventGen.logger = loggerInst;
EventGen.dumpEvent = true; // for LoggerBuf only!

if (Logger != LoggerBuf && EventGen.dumpEvent)
    throw "Invalid config: Can only dump event from LoggerBuf";
